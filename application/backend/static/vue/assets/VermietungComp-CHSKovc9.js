import{e as h,j as e,as as f,i,C as s,ax as j,au as p,av as u,c as k,az as O,F as R,aD as H,a7 as C,r as l,aj as w,S as K,aR as v,b8 as M,a5 as L,M as W,b9 as G,ag as q,D as U,ba as J,X as $,aN as Z,aL as Q,g as X,I as P,bb as Y,B as D,aG as _,d as ee,aV as se,aY as ne,aZ as ae,H as te,a$ as re,bc as ie,b1 as le,b2 as ce,ab as oe,u as ue,ac as he,bd as de,ad as be,be as ge}from"./main-zpu8IzFY.js";import{u as me,S as xe,a as je,M as fe,T as pe,K as I,b as S,L as B,P as ke,d as Te,c as Ae}from"./dynamicHeaderTags-BAXiDkFX.js";function ve(){const r=h("brauchtPresse",{preserve:!0}),n=h(["technik","checked"],{preserve:!0}),{presseChecked:t}=me(!0);return e.jsxs(f,{label:"Event",noTopBorder:!0,suffix:"allgemeines",children:[e.jsxs(i,{children:[e.jsxs(s,{span:8,children:[e.jsx(j,{label:"Ist bestätigt",name:["kopf","confirmed"]}),e.jsx(j,{label:"Braucht Technik",name:"brauchtTechnik"}),e.jsx(j,{label:"Braucht Presse",name:"brauchtPresse"}),e.jsx(j,{label:"Braucht Bar",name:"brauchtBar"})]}),e.jsxs(s,{span:8,children:[n?e.jsxs(e.Fragment,{children:[e.jsx(j,{label:"Technik ist geklärt",name:["technik","checked"]}),e.jsx(j,{label:"Flügel stimmen",name:["technik","fluegel"]})]}):null,r?e.jsxs(e.Fragment,{children:[e.jsx(j,{label:"Presse OK",name:["presse","checked"],onChange:t}),e.jsx(j,{label:"Fotograf einladen",name:["kopf","fotografBestellen"]})]}):null]}),e.jsxs(s,{span:8,children:[e.jsx(j,{label:"Ist auf Homepage",name:["kopf","kannAufHomePage"]}),e.jsx(j,{label:"Kann Social Media",name:["kopf","kannInSocialMedia"]})]})]}),e.jsxs(i,{children:[e.jsx(s,{span:16,children:e.jsx(p,{label:"Titel",name:["kopf","titel"],required:!0})}),e.jsx(s,{span:8,children:e.jsx(u,{decimals:2,label:"Saalmiete",name:["saalmiete"],suffix:"€"})})]}),e.jsx(i,{children:e.jsx(s,{span:24,children:e.jsx(xe,{})})})]})}function Ce(){const{optionen:r}=k();return e.jsx(f,{label:"Künstler",suffix:"allgemeines",children:e.jsxs(i,{children:[e.jsx(s,{span:12,children:e.jsx(O,{label:"Namen",name:["artist","name"],options:r.artists})}),e.jsx(s,{span:6,children:e.jsx(u,{decimals:2,label:"Gage (Netto)",name:["kosten","gagenEUR"],suffix:"€"})})]})})}function Fe(){return e.jsxs(f,{label:"Vertragspartner",suffix:"allgemeines",children:[e.jsx(i,{children:e.jsxs(s,{span:24,children:[e.jsx(p,{label:"Name",name:["vertragspartner","name"]}),e.jsx(R.Item,{label:e.jsx("b",{children:"Adresse:"}),name:["vertragspartner","adresse"],children:e.jsx(H,{rows:7})})]})}),e.jsxs(i,{children:[e.jsx(s,{span:12,children:e.jsx(p,{label:"Telefon",name:["vertragspartner","telefon"]})}),e.jsx(s,{span:12,children:e.jsx(p,{isEmail:!0,label:"E-Mail",name:["vertragspartner","email"]})})]})]})}function Re(){return e.jsxs(i,{children:[e.jsxs(s,{lg:12,xs:24,children:[e.jsx(ve,{}),e.jsx(Ce,{}),e.jsx(je,{})]}),e.jsxs(s,{lg:12,xs:24,children:[e.jsx(fe,{forVermietung:!0}),e.jsx(Fe,{})]})]})}function Be(){return e.jsx(i,{children:e.jsx(s,{span:24,children:e.jsx(pe,{fuerVermietung:!0})})})}function Ee(){const r=C(),n=h("saalmiete",{form:r,preserve:!0}),t=l.useMemo(()=>n??0,[n]);return e.jsx(f,{amount:t,label:"Einnahmen",noTopBorder:!0,suffix:"ausgaben",children:e.jsx(i,{children:e.jsx(s,{span:12,children:e.jsx(u,{decimals:2,label:"Saalmiete",name:"saalmiete",required:!0,suffix:"€"})})})})}function ze(){const r=C();return new M(r.getFieldsValue(!0)).technik.fluegel&&e.jsx(B,{label:"Flügelstimmer",path:["kosten","fluegelstimmerEUR"]})}const ye=["ohne","7% MWSt.","19% MWSt.","18,8% Ausland"];function Se(){const r=C(),n=h("brauchtTechnik",{form:r,preserve:!0}),t=h("kosten",{form:r,preserve:!0}),a=l.useMemo(()=>{const b=new I(t),m=b.totalEUR;return n?m:m-b.backlineUndTechnikEUR},[n,t]),c=h(["kosten","gagenEUR"],{preserve:!0}),g=h(["kosten","gagenSteuer"],{preserve:!0}),o=l.useMemo(()=>new I(r.getFieldValue("kosten")),[r,c,g]),{lg:d}=w();return e.jsxs(f,{amount:a,label:"Kosten / Ausgaben",noTopBorder:d,suffix:"ausgaben",children:[e.jsxs(i,{children:[e.jsx(s,{span:6,children:e.jsx(u,{decimals:2,label:"Gagen",name:["kosten","gagenEUR"],suffix:"€"})}),e.jsx(s,{span:6,children:e.jsx(K,{label:"Steuer",name:["kosten","gagenSteuer"],options:ye})}),e.jsx(s,{span:6,children:e.jsx(v,{decimals:2,label:"Total",suffix:"€",value:o.gagenTotalEUR})})]}),n?e.jsx(ze,{}):null,e.jsx(S,{label:"Werbung 1",path:["kosten","werbung1"]}),e.jsx(S,{label:"Werbung 2",path:["kosten","werbung2"]}),e.jsx(S,{label:"Werbung 3",path:["kosten","werbung3"]}),e.jsx(B,{label:"Personal (unbar)",path:["kosten","personal"]}),n?e.jsxs(e.Fragment,{children:[e.jsx(B,{disabled:!0,label:"Backline Rockshop",path:["kosten","backlineEUR"]}),e.jsx(B,{disabled:!0,label:"Technik Zumietung",path:["kosten","technikAngebot1EUR"]})]}):null]})}function Ve(){return e.jsxs(i,{children:[e.jsx(s,{lg:12,xs:24,children:e.jsx(Ee,{})}),e.jsx(s,{lg:12,xs:24,children:e.jsx(Se,{})})]})}function Me(){return e.jsx(i,{children:e.jsx(s,{span:24,children:e.jsx(ke,{isVermietung:!0})})})}class Pe{constructor(n){this.saalmiete=0,this.saalmieteRabatt=0,this.tontechnikerAnzahl=1,this.tontechnikerBetrag=0,this.lichttechnikerAnzahl=1,this.lichttechnikerBetrag=0,this.musikerAnzahl=1,this.musikerGage=0,this.reinigungHaus=0,this.barpersonalAnzahl=1,this.barpersonalBetrag=0,this.reinigungBar=0,this.abenddienst=0,this.fluegel=0,this.status="offen",this.frei1="",this.frei1EUR=0,this.frei2="",this.frei2EUR=0,this.frei3="",this.frei3EUR=0,this.beschreibung="",this.freigabe="",n&&L(n).length&&Object.assign(this,n,{freigabeAm:W.stringOrDateToDate(n.freigabeAm)})}get saalmieteTotal(){return this.saalmiete+this.saalmieteRabattEUR}get saalmieteRabattEUR(){return-(this.saalmiete*this.saalmieteRabatt/100)}get tontechnikerTotal(){return this.tontechnikerAnzahl*this.tontechnikerBetrag}get lichttechnikerTotal(){return this.lichttechnikerAnzahl*this.lichttechnikerBetrag}get musikerTotal(){return this.musikerAnzahl*this.musikerGage}get barpersonalTotal(){return this.barpersonalAnzahl*this.barpersonalBetrag}get renderedBeschreibung(){return G.render(this.beschreibung||"")}get summe(){return this.saalmieteTotal+this.tontechnikerTotal+this.lichttechnikerTotal+this.musikerTotal+this.barpersonalTotal+this.reinigungHaus+this.reinigungBar+this.fluegel+this.frei1EUR+this.frei2EUR+this.frei3EUR+this.abenddienst}}function V({nummer:r,readonly:n}){const t=h(["angebot",`frei${r}EUR`],{preserve:!0});return e.jsxs(i,{children:[e.jsx(s,{span:16,children:e.jsx(p,{disabled:n,label:`Freifeld ${r}`,name:["angebot",`frei${r}`],required:t>0})}),e.jsx(s,{span:8,children:e.jsx(u,{decimals:2,disabled:n,label:"Betrag",name:["angebot",`frei${r}EUR`],suffix:"€"})})]})}function Ue(){const r=C(),n=h("angebot",{form:r,preserve:!0}),t=l.useMemo(()=>new Pe(n),[n]),a=l.useMemo(()=>!!t.freigabe,[t.freigabe]),{lg:c}=w();return e.jsxs(f,{amount:t.summe,label:"Posten",noTopBorder:c,suffix:"angebot",children:[e.jsxs(i,{children:[e.jsx(s,{span:8,children:e.jsx(u,{decimals:2,disabled:a,label:"Saalmiete",name:["angebot","saalmiete"],suffix:"€"})}),e.jsx(s,{span:8,children:e.jsx(u,{decimals:0,disabled:a,label:"Rabatt (optional)",name:["angebot","saalmieteRabatt"],suffix:"%"})}),e.jsx(s,{span:8,children:e.jsx(v,{decimals:2,label:"Total",suffix:"€",value:t.saalmieteTotal})})]}),e.jsxs(i,{children:[e.jsx(s,{span:8,children:e.jsx(u,{decimals:0,disabled:a,label:"Tontechniker (Anzahl)",name:["angebot","tontechnikerAnzahl"]})}),e.jsx(s,{span:8,children:e.jsx(u,{decimals:2,disabled:a,label:"Tontechniker (Einzelpreis)",name:["angebot","tontechnikerBetrag"],suffix:"€"})}),e.jsx(s,{span:8,children:e.jsx(v,{decimals:2,label:"Total",suffix:"€",value:t.tontechnikerTotal})})]}),e.jsxs(i,{children:[e.jsx(s,{span:8,children:e.jsx(u,{decimals:0,disabled:a,label:"Lichttechniker (Anzahl)",name:["angebot","lichttechnikerAnzahl"]})}),e.jsx(s,{span:8,children:e.jsx(u,{decimals:2,disabled:a,label:"Lichttechniker (Einzelpreis)",name:["angebot","lichttechnikerBetrag"],suffix:"€"})}),e.jsx(s,{span:8,children:e.jsx(v,{decimals:2,label:"Total",suffix:"€",value:t.lichttechnikerTotal})})]}),e.jsxs(i,{children:[e.jsx(s,{span:8,children:e.jsx(u,{decimals:0,disabled:a,label:"Musiker (Anzahl)",name:["angebot","musikerAnzahl"]})}),e.jsx(s,{span:8,children:e.jsx(u,{decimals:2,disabled:a,label:"Musiker (Einzelpreis)",name:["angebot","musikerGage"],suffix:"€"})}),e.jsx(s,{span:8,children:e.jsx(v,{decimals:2,label:"Total",suffix:"€",value:t.musikerTotal})})]}),e.jsx(i,{children:e.jsx(s,{span:8,children:e.jsx(u,{decimals:2,disabled:a,label:"Flügel (Einzelpreis)",name:["angebot","fluegel"],suffix:"€"})})}),e.jsxs(i,{children:[e.jsx(s,{span:8,children:e.jsx(u,{decimals:0,disabled:a,label:"Bar Personal (Anzahl)",name:["angebot","barpersonalAnzahl"]})}),e.jsx(s,{span:8,children:e.jsx(u,{decimals:2,disabled:a,label:"Bar Personal (Einzelpreis)",name:["angebot","barpersonalBetrag"],suffix:"€"})}),e.jsx(s,{span:8,children:e.jsx(v,{decimals:2,label:"Total",suffix:"€",value:t.barpersonalTotal})})]}),e.jsxs(i,{children:[e.jsx(s,{span:8,children:e.jsx(u,{decimals:2,disabled:a,label:"Abenddienst",name:["angebot","abenddienst"],suffix:"€"})}),e.jsx(s,{span:8,children:e.jsx(u,{decimals:2,disabled:a,label:"Reinigung Haus",name:["angebot","reinigungHaus"],suffix:"€"})}),e.jsx(s,{span:8,children:e.jsx(u,{decimals:2,disabled:a,label:"Reinigung Bar",name:["angebot","reinigungBar"],suffix:"€"})})]}),e.jsx(V,{nummer:1,readonly:a}),e.jsx(V,{nummer:2,readonly:a}),e.jsx(V,{nummer:3,readonly:a})]})}function De({freigabe:r}){const n=C(),{currentUser:t,isDirty:a}=k(),c=l.useMemo(()=>t.accessrights.darfKasseFreigeben,[t.accessrights.darfKasseFreigeben]),g=l.useMemo(()=>t.accessrights.isSuperuser,[t.accessrights.isSuperuser]),{modal:o}=Y.useApp(),d=l.useCallback(()=>o.confirm({type:"confirm",title:"Rechnung freigeben",content:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx(P,{color:"red",iconName:"ExclamationCircleFill"})," Nach dem Freigeben ist keine Änderung mehr möglich!"]}),e.jsx("p",{children:"Du musst danach noch Speichern, dabei wird die Rechnung an die Buchhaltung gesendet."})]}),onOk:()=>{n.setFieldValue(["angebot","freigabe"],t.name),n.setFieldValue(["angebot","freigabeAm"],new Date)}}),[o,n,t.name]),b=l.useCallback(()=>o.confirm({type:"confirm",title:"Freigabe rückgängig",content:"Bist Du sicher?",onOk:()=>{n.setFieldValue(["angebot","freigabe"],""),n.setFieldValue(["angebot","freigabeAm"],void 0)}}),[o,n]);return r?e.jsxs(e.Fragment,{children:[e.jsx(R.Item,{label:" ",children:e.jsx(D,{block:!0,color:"#c71c2c",disabled:a||!g,icon:"Lock",onClick:b,text:"Ist freigegeben",type:"primary"})}),e.jsx(p,{disabled:!0,label:"Durch",name:["angebot","freigabe"]})]}):e.jsx(R.Item,{label:" ",children:e.jsx(D,{block:!0,disabled:status!=="abgerechnet"||a||!c,icon:"Unlock",onClick:d,text:"Rechnung freigeben..."})})}function Ie(){const r=C(),{isDirty:n}=k(),{checkDirty:t}=l.useContext(q),a=h(["angebot","status"],{form:r,preserve:!0}),c=h("startDate",{form:r,preserve:!0}),g=l.useMemo(()=>U.forJSDate(c).istVor(new U),[c]),o=h(["angebot","freigabe"],{form:r,preserve:!0});l.useEffect(()=>{t()},[t,o]);const d=l.useMemo(()=>{function T(y,A,N){return{label:e.jsxs("b",{children:[e.jsx(P,{iconName:y}),"   ",A]}),value:N}}return[T("QuestionCircleFill","Angebot","offen"),T("ExclamationCircleFill","Verschickt","verschickt"),T("CheckCircleFill","Angenommen","angenommen"),T("Coin","Rechnung","abgerechnet")]},[]),b=l.useMemo(()=>a==="abgerechnet"?["Angebot","Vertrag","Rechnung"]:["Angebot","Vertrag"],[a]),m=h("id",{preserve:!0}),x=l.useCallback(()=>J(new M(r.getFieldsValue(!0))),[r]),{useToken:E}=$,z=E().token;return e.jsxs(f,{label:"Infos",suffix:"angebot",children:[e.jsx(i,{children:e.jsx(s,{span:24,children:e.jsx(Z,{theme:{token:{colorPrimary:z.colorSuccess}},children:e.jsx(R.Item,{initialValue:"offen",name:["angebot","status"],children:e.jsx(Q.Group,{buttonStyle:"solid",disabled:!!o,optionType:"button",options:d})})})})}),e.jsx(i,{children:e.jsx(s,{span:12,children:a==="abgerechnet"&&e.jsx(p,{label:"Rechnungsnummer",name:["angebot","rechnungsnummer"],required:a==="abgerechnet"})})}),n?e.jsx("b",{children:"Vor dem generieren musst Du speichern!"}):null,e.jsxs(i,{children:[e.jsx(s,{span:6,children:e.jsx(K,{label:"Art",name:"art",options:b})}),e.jsx(s,{span:8,children:e.jsx(R.Item,{label:" ",children:e.jsx(X,{block:!0,disabled:n||!m,onClick:x,type:"primary",children:"Generieren"})})}),e.jsx(s,{span:10,children:g?e.jsx(De,{freigabe:!!o}):null})]})]})}function we(){return e.jsx(f,{label:"Kommentar",noTopBorder:!0,suffix:"angebot",children:e.jsx(i,{children:e.jsx(s,{span:24,children:e.jsx(_,{label:e.jsx("b",{children:"Zusätzliche Infos:"}),name:["angebot","beschreibung"]})})})})}function Ke(){return e.jsxs(i,{children:[e.jsx(s,{lg:12,xs:24,children:e.jsx(Ue,{})}),e.jsxs(s,{lg:12,xs:24,children:[e.jsx(we,{}),e.jsx(Ie,{})]})]})}function F({activePage:r,title:n,type:t}){const{icon:a,color:c}=ne,{brightText:g}=k(),o=r===t,d=c(t);return e.jsxs("b",{style:{margin:-16,padding:16,backgroundColor:o?d:"inherit",color:o?g:d},children:[e.jsx(P,{iconName:a(t)})," ",n]})}function Ne(){const{optionen:r}=k(),[n,t]=ee(),[a,c]=l.useState("allgemeines"),[g,o]=l.useState([]);l.useEffect(()=>{const x=n.get("page")??"allgemeines";["allgemeines","angebot","technik","ausgaben","presse"].includes(x)?c(x):(c("allgemeines"),t({page:"allgemeines"},{replace:!0}))},[n,t]);const d=h("brauchtTechnik",{preserve:!0}),b=h("brauchtPresse",{preserve:!0});l.useEffect(()=>{const x={key:"allgemeines",label:e.jsx(F,{activePage:a,title:"Allgemeines",type:"allgemeines"}),children:e.jsx(Re,{})},E={key:"angebot",label:e.jsx(F,{activePage:a,title:"Angebot / Vertrag",type:"angebot"}),children:e.jsx(Ke,{})},z={key:"technik",label:e.jsx(F,{activePage:a,title:"Technik",type:"technik"}),children:e.jsx(Be,{})},T={key:"ausgaben",label:e.jsx(F,{activePage:a,title:"Kalkulation",type:"ausgaben"}),children:e.jsx(Ve,{})},y={key:"presse",label:e.jsx(F,{activePage:a,title:"Presse",type:"presse"}),children:e.jsx(Me,{})},A=[x,E];d&&A.push(z),A.push(T),b&&A.push(y),o(A)},[a,r,d,b]);const m=l.useCallback(x=>t({page:x}),[t]);return e.jsx(se,{activeKey:a,items:g,onChange:m,type:"card"})}function Oe({data:r,saveForm:n,resetChanges:t,children:a}){document.title="Vermietung";const[c]=ae(),{isDirty:g}=k(),o=h("id",{form:c,preserve:!0}),d=h("startDate",{form:c,preserve:!0}),b=h(["kopf","titel"],{form:c,preserve:!0}),m=l.useMemo(()=>te.forJSDate(d).lesbareKurzform,[d]),x=l.useMemo(()=>Te([{label:"Bestätigt",labelNotOk:"Unbestätigt",path:["kopf","confirmed"]},{label:"Technik",dependsOn:"brauchtTechnik",path:["technik","checked"]},{label:"Presse",dependsOn:"brauchtPresse",path:["presse","checked"]},{label:"Homepage",path:["kopf","kannAufHomePage"]},{label:"Social Media",path:["kopf","kannInSocialMedia"]},{label:"Bar einladen",path:"brauchtBar"}]),[]);return e.jsx(re,{additionalButtons:[e.jsx(ce,{disabled:!o,isDirty:g,isVermietung:!0},"more")],additionalButtonsLast:[e.jsx(le,{},"cal")],data:r,dateString:m,firstTag:e.jsx(ie,{color:"purple",children:"Vermietung"},"verm"),form:c,resetChanges:t,saveForm:n,tags:x,title:b,children:a})}function We(){const{url:r}=oe(),{data:n,refetch:t}=ue({queryKey:["vermietung",r],queryFn:()=>ge(r??"")}),a=he({saveFunction:de,queryKey:"vermietung",successMessage:"Die Vermietung wurde gespeichert",forwardForNew:!0}),{currentUser:c,setMemoizedVeranstaltung:g}=k(),o=be();l.useEffect(()=>{g({veranstaltung:n,highlight:!0})},[n,g]),l.useEffect(()=>{const b=c.accessrights;c.id&&!b.isOrgaTeam&&o("/team")},[c,o]);const d=l.useCallback(b=>{const m=new M(b);m.id||m.initializeIdAndUrl(),a.mutate(m)},[a]);return e.jsxs(Oe,{data:n,resetChanges:t,saveForm:d,children:[e.jsx(Ae,{title:"Kopierte Vermietung"}),e.jsx(Ne,{})]})}export{We as default};
